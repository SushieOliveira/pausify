<!doctype html>
<html lang="pt">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Editar Perfil - Pausify</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        body {
            background-color: #e9f7f5;
            font-family: system-ui, -apple-system, BlinkMacSystemFont;
        }

        main {
            max-width: 420px;
            margin: auto;
            padding: 30px 20px;
            min-height: 100vh;
        }

        .form-range::-webkit-slider-thumb {
            background-color: #0a5c60;
        }

        .form-range::-moz-range-thumb {
            background-color: #0a5c60;
        }

        .form-control {
            border-radius: 30px;
            text-align: center;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #0a5c60;
        }

        .form-control:focus {
            box-shadow: none;
            border-color: #0a5c60;
        }

        .section-title {
            text-align: center;
            font-weight: 800;
            text-transform: uppercase;
            margin: 35px 0 20px;
        }

        .avatars {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 5px;
            margin: 15px 0;
        }

        .avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
            transition: transform 0.2s, border-color 0.2s;
            border: 5px solid transparent;
        }

        .avatar img {
            width: 72px;
            border-radius: 50%;
        }

        .avatar:hover {
            transform: scale(1.1);
        }

        .avatar.selecionado {
            transform: scale(1.2);
        }

        .delete-btn {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: #0a5c60;
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            transition: background-color 0.2s;
            pointer-events: auto;
        }

        .delete-btn::before {
            content: "üóëÔ∏è";
            display: block;
            font-size: 16px;
            line-height: 1;
        }

        .delete-btn:hover {
            background-color: red;
        }

        .btn-upload {
            background-color: #ffffff;
            color: #0a5c60;
            border: 2px solid #0a5c60;
            padding: 6px 15px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            font-size: 0.9rem;
            display: inline-block;
        }

        .btn-upload:hover {
            background-color: #0a5c60;
            color: #ffffff;
        }

        .btn-guardar {
            background-color: #0a5c60;
            color: white;
            border-radius: 30px;
            padding: 12px;
            font-weight: bold;
            border: 2px solid white;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s, border-color 0.2s;
        }

        .btn-guardar:hover {
            background-color: white;
            color: #0a5c60;
            border-color: #0a5c60;
        }

        #idadeValor {
            font-size: 2rem;
            font-weight: 800;
            color: #0a5c60;
        }

        textarea#botaosobreti {
            width: calc(100% - 20px);
            margin: 0 auto 15px auto;
            border-radius: 20px;
            border: 1px solid #0a5c60;
            padding: 10px;
            text-align: center;
            resize: none;
            display: block;
        }

        @media (max-width: 576px) {
            .avatar {
                width: 80px;
                height: 80px;
            }
            .avatar img {
                width: 60px;
            }
        }
        .header-top {
            display: flex;
            align-items: center;
            padding: 10px 0;
            position: relative;
        }

        .btn-back {
            position: absolute;
            left: 0;
            font-size: 1.5rem;
            color: #0a5c60;
            text-decoration: none;
        }

        .page-title {
            flex: 1;
            text-align: center;
            font-weight: 800;
            font-size: 1.2rem;
            text-transform: uppercase;
            color: #0a5c60;
        }

    </style>
</head>
<body>
<main>

    <div class="header-top">
        <a href="javascript:history.back()" class="btn-back"><i class="bi bi-arrow-left"></i></a>
        <div class="page-title">Editar Perfil</div>
    </div>


    <label for="botaonome" class="form-label text-center w-100 fw-bold">Nome</label>
    <input type="text" id="botaonome" class="form-control" placeholder="Inserir nome">


    <label for="botaoapelido" class="form-label text-center w-100 fw-bold">Apelido</label>
    <input type="text" id="botaoapelido" class="form-control" placeholder="Inserir apelido">


    <label class="form-label text-center w-100 fw-bold">Idade</label>
    <div class="text-center mb-3">
        <span id="idadeValor">18</span>
        <span style="font-size: 1.2rem;">anos</span>
    </div>
    <input type="range" id="idade" class="form-range" min="1" max="99" value="18">


    <label for="botaosobreti" class="form-label text-center w-100 fw-bold">Sobre ti</label>
    <textarea id="botaosobreti" rows="3" placeholder="Escreve algo sobre ti..."></textarea>


    <div class="section-title">Escolher Avatar</div>
    <div class="avatars" id="avatars">
        <div class="avatar">
            <img src="https://cdn-icons-png.flaticon.com/512/147/147144.png" alt="Avatar Homem">
        </div>
        <div class="avatar">
            <img src="https://cdn-icons-png.flaticon.com/512/194/194938.png" alt="Avatar Mulher">
        </div>
    </div>


    <div class="text-center mt-3">
        <label class="btn-upload">
            Carregar imagem
            <input type="file" id="uploadAvatar" accept="image/*" hidden>
        </label>
    </div>


    <div class="d-grid mt-4">
        <button class="btn-guardar" id="btnGuardar">GUARDAR</button>
    </div>
</main>

<script>
    window.onload = function () {
        var inpNome = document.getElementById("botaonome");
        var inpApelido = document.getElementById("botaoapelido");
        var inpBio = document.getElementById("botaosobreti");
        var idadeSlider = document.getElementById("idade");
        var idadeValor = document.getElementById("idadeValor");
        var btnGuardar = document.getElementById("btnGuardar");
        var avatarsContainer = document.getElementById("avatars");
        var uploadInput = document.getElementById("uploadAvatar");
        var avatarSelecionado = null;

        var userLogado = JSON.parse(localStorage.getItem('userLogado'));
        if (!userLogado || !userLogado.username) { window.location.href = "login.html"; return; }
        var loginAtual = userLogado.username;
        var utilizadores = JSON.parse(localStorage.getItem('utilizadores')) || [];
        var u = utilizadores.find(x => x.login === loginAtual);
        if (!u) { window.location.href = "login.html"; return; }

        // Preencher campos
        inpNome.value = u.nome;
        inpApelido.value = u.apelido;
        inpBio.value = u.bio || "";
        idadeSlider.value = u.idade || 18;
        idadeValor.textContent = idadeSlider.value;

        // Slider de idade
        idadeSlider.addEventListener('input', function() {
            idadeValor.textContent = idadeSlider.value;
        });

        // Sele√ß√£o de avatar
        function selecionarAvatar(avatar) {
            avatarsContainer.querySelectorAll('.avatar').forEach(a => a.classList.remove('selecionado'));
            avatar.classList.add('selecionado');
            avatarSelecionado = avatar.querySelector('img').src;
        }

        avatarsContainer.querySelectorAll('.avatar').forEach(av => av.addEventListener('click', function(){ selecionarAvatar(this); }));

        // Avatar atual
        if (u.avatar) {
            avatarSelecionado = u.avatar;
            var encontrado = false;
            avatarsContainer.querySelectorAll('img').forEach(img => {
                if (img.src === u.avatar) { selecionarAvatar(img.parentNode); encontrado = true; }
            });
            if (!encontrado) {
                var novoAvatar = document.createElement('div');
                novoAvatar.className = "avatar uploaded";
                var imgUp = document.createElement('img');
                imgUp.src = u.avatar;
                novoAvatar.appendChild(imgUp);
                var deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.onclick = function(ev){ ev.stopPropagation(); avatarsContainer.removeChild(novoAvatar); avatarSelecionado = null; uploadInput.value = ''; };
                novoAvatar.appendChild(deleteBtn);
                novoAvatar.onclick = function(){ selecionarAvatar(novoAvatar); };
                avatarsContainer.appendChild(novoAvatar);
                selecionarAvatar(novoAvatar);
            }
        }

        // Upload de avatar
        uploadInput.addEventListener('change', function() {
            if (avatarsContainer.querySelectorAll('.avatar.uploaded').length > 0) { alert("S√≥ pode adicionar 1 avatar carregado!"); return; }
            var file = this.files[0]; if (!file) return;
            var reader = new FileReader();
            reader.onload = function(e) {
                var novoAvatar = document.createElement('div');
                novoAvatar.className = 'avatar uploaded';
                var img = document.createElement('img'); img.src = e.target.result; novoAvatar.appendChild(img);
                var deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.onclick = function(ev){ ev.stopPropagation(); avatarsContainer.removeChild(novoAvatar); avatarSelecionado = null; uploadInput.value = ''; };
                novoAvatar.appendChild(deleteBtn);
                novoAvatar.onclick = function(){ selecionarAvatar(novoAvatar); };
                avatarsContainer.appendChild(novoAvatar);
                selecionarAvatar(novoAvatar);
            };
            reader.readAsDataURL(file);
        });

        // Guardar altera√ß√µes
        btnGuardar.addEventListener('click', function() {
            u.nome = inpNome.value;
            u.apelido = inpApelido.value;
            u.idade = idadeSlider.value;
            u.bio = inpBio.value;
            if (avatarSelecionado) u.avatar = avatarSelecionado;
            localStorage.setItem('utilizadores', JSON.stringify(utilizadores));
            window.location.href = "perfil.html";
        });
    };
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>
</body>
</html>
